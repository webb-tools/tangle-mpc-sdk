"use strict";var I=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(r,e,t)=>e in r?I(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ee=(r,e)=>{for(var t in e)I(r,t,{get:e[t],enumerable:!0})},re=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of X(e))!Y.call(r,n)&&n!==t&&I(r,n,{get:()=>e[n],enumerable:!(o=V(e,n))||o.enumerable});return r};var te=r=>re(I({},"__esModule",{value:!0}),r);var S=(r,e,t)=>(Z(r,typeof e!="symbol"?e+"":e,t),t);var ce={};ee(ce,{DisjointError:()=>y,OperationError:()=>x,OperationInaccessibleError:()=>T,OperationLimitError:()=>g,RpcError:()=>C,StopError:()=>O,TransactionError:()=>w,createClient:()=>ae});module.exports=te(ce);var W=class extends Error{constructor(){super("Aborted by AbortSignal"),this.name="AbortError"}},_=r=>(...e)=>new Promise((t,o)=>{let[n,a]=e[e.length-1]instanceof AbortSignal?[e.slice(0,e.length-1),e[e.length-1]]:[e],d=()=>{l(),o(new W)};a?.addEventListener("abort",d,{once:!0});let c=p=>m=>{a?.removeEventListener("abort",d),p(m)},l=r(c(t),c(o),...n)});function k(){let r=()=>{},e=()=>{};return{promise:new Promise((o,n)=>{r=o,e=n}),res:r,rej:e}}var E=()=>{};var A=()=>{let r=new Map;return{has:r.has.bind(r),subscribe(e,t){r.set(e,t)},unsubscribe(e){r.delete(e)},next(e,t){r.get(e)?.next(t)},error(e,t){let o=r.get(e);o&&(r.delete(e),o.error(t))},errorAll(e){let t=[...r.values()];r.clear(),t.forEach(o=>{o.error(e)})}}};var oe=r=>{let{event:e,...t}=r;return{type:e,...t}},ne=new Set(["dropped","invalid","finalized","error"]);function ie(r){return ne.has(r.event)}var w=class extends Error{constructor(t){super(`TxError: ${t.event} - ${t.error}`);S(this,"type");S(this,"error");this.type=t.event,this.error=t.error,this.name="TransactionError"}},L=r=>(e,t,o)=>{let n=r("transaction_unstable_submitAndWatch",[e],{onSuccess:(a,d)=>{let c=d(a,{next:l=>{if(ie(l)&&(c(),n=E,l.event!=="finalized"))return o(new w(l));t(oe(l))},error(l){n(),n=E,o(l)}});n=()=>{c(),r("transaction_unstable_unwatch",[a])}},onError:o});return()=>{n()}};var O=class extends Error{constructor(){super("ChainHead stopped"),this.name="StopError"}},y=class extends Error{constructor(){super("ChainHead disjointed"),this.name="DisjointError"}},g=class extends Error{constructor(){super("ChainHead operations limit reached"),this.name="OperationLimitError"}},x=class extends Error{constructor(e){super(e),this.name="OperationError"}},T=class extends Error{constructor(){super("ChainHead operation inaccessible"),this.name="OperationInaccessibleError"}};var P=(r,e)=>t=>_((o,n,...a)=>{let[d,c]=e(...a),l=t(r,d,{onSuccess:(p,m)=>{if(p.result==="limitReached")return l=E,n(new g);let u=!0,s=E,R=b=>{u=!1,s(),o(b)},i=b=>{u=!1,s(),n(b)};s=m(p.operationId,{next:b=>{let f=b;f.event==="operationError"?n(new x(f.error)):f.event==="operationInaccessible"?n(new T):c(b,R,i)},error:i}),l=()=>{u&&(s(),t("chainHead_unstable_stopOperation",[p.operationId]))}},onError:n});return()=>{l()}});var N=P("chainHead_unstable_body",r=>[[r],(e,t)=>{t(e.value)}]);var z=P("chainHead_unstable_call",(r,e,t)=>[[r,e,t],(o,n)=>{n(o.output)}]);var B=r=>e=>new Promise((t,o)=>{r("chainHead_unstable_header",[e],{onSuccess:t,onError:o})});var H=require("@polkadot-api/utils");var D=r=>(e,t,o,n,a,d,c)=>{if(t.length===0)return d(),H.noop;let l=r("chainHead_unstable_storage",[e,t,o],{onSuccess:(p,m)=>{if(p.result==="limitReached"||p.discardedItems===t.length)return a(new g);let u=m(p.operationId,{next:i=>{switch(i.event){case"operationStorageItems":{n(i.items);break}case"operationStorageDone":{R();break}case"operationError":{s(new x(i.error));break}case"operationInaccessible":{s(new T);break}default:r("chainHead_unstable_continue",[])}},error:a});l=()=>{u(),r("chainHead_unstable_stopOperation",[p.operationId])};let s=i=>{l=H.noop,u(),a(i)},R=()=>{l=H.noop,u(),d()};c(p.discardedItems)},onError:a});return()=>{l()}};var J=r=>{let e=D(r);return _((t,o,n,a,d,c)=>{let l=a.startsWith("descendants"),p=l?[]:null,u=e(n,[{key:d,type:a}],c??null,l?s=>{p.push(...s)}:s=>{p=s[0]?.[a]},o,()=>{t(p)},s=>{s>0&&(u(),o(new g))});return u})};var $=r=>e=>new Promise((t,o)=>{r("chainHead_unstable_unpin",[e],{onSuccess(){t()},onError:o})});function se(r){return r.operationId!==void 0}function j(r){return(e,t,o)=>{let n=A(),a=new Set,d=k(),c=d.promise,l=i=>{if(se(i))return n.next(i.operationId,i);if(i.event!=="stop"){let{event:b,...f}=i;return t({type:b,...f})}o(new O),s(!1)},p=i=>{o(i),s()},s=r("chainHead_unstable_follow",[e],{onSuccess:(i,b)=>{let f=b(i,{next:l,error:p});s=(v=!0)=>{c=null,s=E,f(),v&&r("chainHead_unstable_unfollow",[i]),n.errorAll(new y),a.forEach(q=>{q()}),a.clear()},c=i,d.res(i)},onError:i=>{o(i),c=null,d.res(i)}}),R=(i,b,f)=>{let v=()=>{f?.onError(new y)};if(c===null)return v(),E;let q=F=>{if(!f)return r(i,[F,...b]);a.add(v);let K=(h,M)=>c===null?(M.error(new y),E):(n.subscribe(h,M),()=>{n.unsubscribe(h)}),Q=r(i,[F,...b],{onSuccess:h=>{a.delete(v),f.onSuccess(h,K)},onError:h=>{a.delete(v),f.onError(h)}});return()=>{a.delete(v),Q()}};if(typeof c=="string")return q(c);let U=E;return c.then(F=>{if(F instanceof Error)return v();c&&(U=q(F))}),()=>{U()}};return{unfollow(){s(),c=null},body:N(R),call:z(R),header:B(R),storage:J(R),storageSubscription:D(R),unpin:$(R),_request:R}}}var C=class extends Error{constructor(t){super(t.message);S(this,"code");S(this,"data");this.code=t.code,this.data=t.data,this.name="RpcError"}};var G=r=>{let e=new Map,t=A(),o=null,n=(p,m,u)=>{o.send(JSON.stringify({jsonrpc:"2.0",id:p,method:m,params:u}))};function a(p){try{let m,u,s,R,i;if({id:m,result:u,error:s,params:R}=JSON.parse(p),m){let b=e.get(m);return b?(e.delete(m),s?b.onError(new C(s)):b.onSuccess(u,(f,v)=>(t.subscribe(f,v),()=>{t.unsubscribe(f)}))):void 0}if({subscription:i,result:u,error:s}=R,!i||!s&&!Object.hasOwn(R,"result"))throw 0;s?t.error(i,new C(s)):t.next(i,u)}catch(m){console.warn("Error parsing incomming message: "+p),console.error(m)}}o=r(a);let d=()=>{o?.disconnect(),o=null},c=1;return{request:(p,m,u)=>{if(!o)throw new Error("Not connected");let s=c++;return u&&e.set(s,u),n(s,p,m),()=>{e.delete(s)}},disconnect:d}};var ae=r=>{let e=G(r);return{chainHead:j(e.request),transaction:L(e.request),destroy:()=>{e.disconnect()},_request:e.request}};
//# sourceMappingURL=index.js.map